{
  "hash": "d6b0418b4e0bc8fe17c2db7fc5cf7b73",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Flight LH402 (FRA - EWR)\"\ndraft: false\nauthor: Christian Jaehnert\ndate: '2025-12-14'\nformat: html\nslug: \ncategories:\n  - R\n  - ggplot\n  - tidyverse\n  - aviation\n  - FRA\n  - EWR\n  - flights\ntags:\n  - R\n  - ggplot\n  - aviation\n  - travel\n  \nsummary: \"I analyze which registration will be used on my flight.\"\n---\n\n# Flight LH402\n\nSoon I will be heading for New York for the Christmas break. I’ll be flying from Hamburg to Newark (EWR) via Frankfurt (FRA) with Lufthansa. On the leg from FRA-EWR Lufthansa is operating with the queen of the skies, the legend Boeing 747.\n\n![source: Unsplash (Lukas Souza)](images/lukas-souza-uQwSG21HiXs-unsplash.jpg){fig-align=\"center\"}\n\nIn this short post, I’ll check some stats of this flight throughout the past year and and toward the end, I’ll also try to predict the registration of the aircraft, I will fly with.\n\nThe foundation of this analysis is data from Flightradar24 about flight LH402 throughout the past year on a daily basis.\n\n\n::: {.cell}\n\n:::\n\n\nAnd here is a very first glimpse on the dataset used.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 4\n  flights first_date last_date  registrations\n    <int> <date>     <date>             <int>\n1     362 2024-12-14 2025-12-13            22\n```\n\n\n:::\n:::\n\n\nWe have data from 362 LH402 flights, ranging from Dec 14th 2024 to Dec 13th 2025 with 22 different (distinct) registrations (aircraft)\n\n## Flighttime\n\n\n::: {.cell}\n\n:::\n\n\nIn the last 362 days, the average flight time was 7:54 h. But how was this different by month? Lets check!\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nIt appears that there is a seasonal effect (though we are looking only into one year). Obviously during spring and summer months (in Germany) the flight time is a bit shorter. There might be different reasons why this is, but the most likely one is the different behavior of the Jetstream. Since I’ll be flying still in December I am expecting a slightly longer flight time.\n\n## Timliness\n\nOf course, I’m very interested in the timeliness of the flight and will investigate this a bit. Here we will look into the difference of scheduled time of departure vs. actual time of departure.\n\n::: panel-tabset\n## All Flights\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n## Flights w/o Outliers\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n:::\n\nThe mean departure delay is 44.5 minutes. In the majority cases it is luckily below, and there is one case with a delay of \\~550 minutes. To account for this, there is another tab, which shows the average delay time, by removing all flights with a delay of more than 200 minutes - it is less: 43.1 minutes.\n\nMost important is to understand, what the impact on arrival timeliness is. Therefore let’s check arrival delays.\n\n::: panel-tabset\n## All flights\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n## Flights w/o Outliers\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm <- data |> \n  filter(between(arr_delay_min, -200, 200) ) |> \n  summarise(m = mean(arr_delay_min, na.rm = TRUE)) |> \n  pull(m)\n\ndata |>\n  filter(between(arr_delay_min, -200, 200) ) |> \n  ggplot(aes(x = arr_delay_min)) +\n  geom_histogram() +\n  geom_vline(xintercept = m, linetype = \"dashed\", linewidth = 1) +\n  annotate(\"text\", x = m, y = Inf, label = round(m, 1), vjust = 1.2) +\n  theme_plex() +\n  labs(x = \"Arrival Delay in min\", y = \"Count\" )\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`stat_bin()` using `bins = 30`. Pick better value `binwidth`.\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n:::\n\nThat looks even better, considering the delay of departure. On average, the flight arrives only 9.2 minutes after scheduled arrival, with more cases even less. The one case at the very left is caused by the heavily delayed flight (day difference). So what happens if we exclude this from the calculation? The arrival delay goes up to 11.7 minutes, but in many cases even earlier. Which is great!\n\n## Aircraft Registration\n\nAccording to [aeronews](https://www.aero.de/news-51430/Lufthansa-verkauft-zwei-Boeing-747-8-und-zwei-747-400.html#:~:text=Aktuell%20betreibt%20Lufthansa%20noch%20acht,wird%20Lufthansa%20beide%20Teilflotten%20verkleinern.), Lufhansa operates 19 aircraft of the type Boeing 747-800 and on top 8 747-400 all with a unique registration. In this dataset we had 22 unique registrations - 22 out of potential 27.\n\nLets investigate, which aircraft is used how often over time.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nThere are few planes, which have been used less than 10-times in the last 362 days to fly from Frankfurt to Newark; the least is D-ABTL.\n\nBut there is also two registrations, which are leading: D-ABYJ and D-ABYC.\n\nWe are currently looking at the data for one year. My assumption is, that rotation of aircrafts can change over time and therefore, in order to predict the registration I will fly with, the more recent registrations are benefitial. Thats why I want to see the usage pattern by registration.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nEach dot in the plot indicates a usage occasion of the aircraft (one flight from FRA to EWR).\n\nAnd yes, we can see differences. While D-ABYA was used consistently over the year, for example D-ABYQ had longer breaks, but has lately intensified.\n\n## Prediction\n\nTo predict the most likely aircraft for 18 Dec even though my dataset ends on 13 Dec, I used a simple Markov transition approach based on the sequence of tail numbers.\n\nFirst, I estimated how many flights per day are typically recorded in the data (only 1; but just to be sure). From the time gap between 13 Dec and 18 Dec, I derived an approximate number of steps, meaning how many consecutive flights I need to move forward in the sequence.\n\nNext, I built a transition table that captures how often one registration is followed by another, and converted those counts into transition probabilities.\n\nTo avoid zero probability cases, I applied a small amount of smoothing.\n\nFinally, I started with the last observed registration on 13 Dec and propagated the probabilities forward by the estimated number of steps. The registration with the highest resulting probability is my best estimate for which aircraft is most likely to operate the flight on 18 Dec.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 1 × 2\n  registration      p\n  <chr>         <dbl>\n1 D-ABYI       0.0653\n```\n\n\n:::\n:::\n\n\nWe see at the very top, there were 22 distinct registrations, which gives us a propability of 1/22 (4.5%) per registration being next, while totally ignoring, that usage patterns of aircraft obviously change over the course of the year and that there is 27 747's.\n\nAccording to my approach, the propability is slightly higher: **with 6.5% it will be D-ABYI**. Nothing I would bet on, but curious to see, what happens.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}