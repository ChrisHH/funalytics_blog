{
  "hash": "970218313f45abcfa9929018f51fa878",
  "result": {
    "markdown": "---\ntitle: \"Flight LH790 (MUC - SIN)\"\nauthor: Christian Jaehnert\ndate: '2023-11-26'\nformat: html\nslug: \ncategories:\n  - R\n  - ggplot\n  - tidyverse\n  - aviation\n  - MUC\n  - SIN\n  - flights\ntags:\n  - R\n  - ggplot\n  - aviation\n  - travel\n  \nsummary: \"This shows an analyis to book the best side of the plane to approach Singapore.\"\n---\n\n\n\n\n## Introduction\n\nHello, it's been a while since my last post! You remember the bears in Canada? üêª\n\nHowever, both this post and the last one share a common theme: they're about my upcoming travels.\\\nI'm eagerly anticipating my trip to Singapore. As a fan of the city, I want to start enjoying it right from the moment of my arrival, which means catching a glimpse of the skyline as the plane approach Changi Airport.\n\nSo, which side of the plane should I sit on to increase my chances of this great view?\n\n![*Source: Swapnil Bapat on Unsplash.com*](singapore_skyline.jpg){fig-align=\"center\"}\n\n**Thankfully, data is here to help! I invite you to join me on this analytical journey.** ‚úàÔ∏è\n\n## Data\n\nMy flight to Singapore is with Lufthansa, departing from Munich. I'll be on flight LH790, a service offered six times per week using the very fuel-efficient A350.\n\nAviation is a passion of mine, so I have a gold membership at [www.flightradar24.com](http://www.flightradar24.com/). ü§ì This enables the download of the flight path for each flight over the past 365 days. I downloaded the data for the last 80 days' flights of LH790. Let's first look at the variables and the date range.\n\n::: {.panel-tabset .nav-pills}\n## Variables\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-1_82a68e77e97bdde733a2113797c822f1'}\n::: {.cell-output .cell-output-stdout}\n```\nRows: 115,502\nColumns: 13\n$ timestamp     <dbl> 1691784874, 1691784882, 1691784892, 1691784903, 16917849‚Ä¶\n$ utc           <dttm> 2023-08-11 20:14:34, 2023-08-11 20:14:42, 2023-08-11 20‚Ä¶\n$ callsign      <chr> \"DLH790\", \"DLH790\", \"DLH790\", \"DLH790\", \"DLH790\", \"DLH79‚Ä¶\n$ lat           <dbl> 48.35789, 48.35788, 48.35789, 48.35790, 48.35798, 48.358‚Ä¶\n$ lon           <dbl> 11.79256, 11.79278, 11.79301, 11.79330, 11.79355, 11.793‚Ä¶\n$ altitude      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,‚Ä¶\n$ speed         <dbl> 3, 4, 4, 4, 4, 4, 0, 0, 4, 5, 6, 6, 12, 13, 14, 15, 15, ‚Ä¶\n$ direction     <dbl> 261, 255, 244, 225, 208, 182, 174, 174, 174, 174, 174, 1‚Ä¶\n$ file_name     <chr> \"LH790_318ce2d1.csv\", \"LH790_318ce2d1.csv\", \"LH790_318ce‚Ä¶\n$ weekday       <ord> Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, F‚Ä¶\n$ weekday_start <ord> Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, Fri, F‚Ä¶\n$ date_start    <date> 2023-08-11, 2023-08-11, 2023-08-11, 2023-08-11, 2023-08‚Ä¶\n$ label         <chr> \"LH790 2023-08-11\", \"LH790 2023-08-11\", \"LH790 2023-08-1‚Ä¶\n```\n:::\n:::\n\n\n## Flight Dates\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-2_f859c0563a5afce0ceb99c3d66ad42f3'}\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"2023-08-11\" \"2023-08-13\" \"2023-08-14\" \"2023-08-15\" \"2023-08-16\"\n [6] \"2023-08-17\" \"2023-08-18\" \"2023-08-20\" \"2023-08-21\" \"2023-08-22\"\n[11] \"2023-08-23\" \"2023-08-24\" \"2023-08-25\" \"2023-08-27\" \"2023-08-28\"\n[16] \"2023-08-29\" \"2023-08-30\" \"2023-08-31\" \"2023-09-01\" \"2023-09-03\"\n[21] \"2023-09-04\" \"2023-09-06\" \"2023-09-07\" \"2023-09-08\" \"2023-09-10\"\n[26] \"2023-09-11\" \"2023-09-13\" \"2023-09-14\" \"2023-09-15\" \"2023-09-17\"\n[31] \"2023-09-18\" \"2023-09-20\" \"2023-09-21\" \"2023-09-22\" \"2023-09-24\"\n[36] \"2023-09-25\" \"2023-09-27\" \"2023-09-28\" \"2023-09-29\" \"2023-10-01\"\n[41] \"2023-10-02\" \"2023-10-04\" \"2023-10-05\" \"2023-10-06\" \"2023-10-08\"\n[46] \"2023-10-09\" \"2023-10-11\" \"2023-10-12\" \"2023-10-13\" \"2023-10-15\"\n[51] \"2023-10-16\" \"2023-10-18\" \"2023-10-19\" \"2023-10-22\" \"2023-10-23\"\n[56] \"2023-10-25\" \"2023-10-26\" \"2023-10-27\" \"2023-10-29\" \"2023-10-30\"\n[61] \"2023-10-31\" \"2023-11-01\" \"2023-11-02\" \"2023-11-03\" \"2023-11-05\"\n[66] \"2023-11-06\" \"2023-11-07\" \"2023-11-08\" \"2023-11-09\" \"2023-11-10\"\n[71] \"2023-11-12\" \"2023-11-13\" \"2023-11-14\" \"2023-11-15\" \"2023-11-16\"\n[76] \"2023-11-17\" \"2023-11-19\" \"2023-11-20\" \"2023-11-21\" \"2023-11-22\"\n```\n:::\n:::\n\n:::\n\nThe data is already quite impressive. From just 80 flights, I've gathered 115,502 data points, averaging about 1,444 per flight. So, what do we have?\n\nThe timestamp and UTC provide the time information. Latitude (Lat) and Longitude (Lon) show the position of the plane at a certain timestamp/UTC. There's also data on speed (in knots), altitude (in feet), and direction (heading) for that moment.\n\nI've already derived some additional variables that might be useful or interesting, such as the weekday, the weekday of departure from Munich (since the date line is crossed during the flight), and a unique label for each flight.\n\nThe following analysis is based on the LH790 flights from August 11th to November 22nd 2023. Nevertheless its onlay 80 days since the connection is not available every day.\n\nNow its time to jump into the data!\n\n## Speed & Altitude\n\nLets scatter both variables, speed and altitude, from the 80 flights.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-3_2adf2bdbd3589986b5c886c2d077f803'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=1260}\n:::\n:::\n\n\nThe plot of speed versus altitude is intriguing. It clearly shows takeoff and landing phases (speed \\> 0 at altitude = 0). It appears the plane takes off at around 150 knots, as that's when altitude begins to increase (vice versa for landing).\n\nThere seems to be a linear relationship between speed and altitude, which is intuitive. But why does it form a funnel shape? This warrants further investigation. My theory is that there's a different relationship (scatter) during the three flight stages:\n\n1.  Takeoff/Climb\n\n2.  Cruise\n\n3.  Landing/Descent\n\nI don't have stage information in the dataset, so I derived it, after removing some of the strange points in the scatter plot (very low speed at high altitude). See the following code.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-4_a4e8fc54c241b256789432f167170769'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Click here to unhide/hide the code.\"}\nall_data <- all_data %>% \n  filter(!(altitude > 100 & speed < 100)) %>% \n  filter(!(altitude > 30000 & speed < 400)) %>% \n  group_by(file_name) %>% \n  arrange(timestamp) %>%\n  mutate(altitude_before = lag(altitude, default = 0),\n         altitude_after = lead(altitude))  %>% \n  filter(!(altitude == 0 & altitude_before == 0 & altitude_after == 0)) \n\nall_data <- all_data %>% \n  group_by(label) %>% \n  arrange(utc, .by_group = TRUE) %>% \n  mutate(startzeit = utc[1], \n         flugdauer = difftime(utc, startzeit, units = \"mins\"),\n         flugdauer = as.numeric(flugdauer))\n\n\ntakeoff_threshold = 10    \nlanding_threshold = -10\n\nall_data <- all_data %>% \n  mutate(gradient = c(NA, diff(altitude) / diff(flugdauer)),\n         smooth_gradient = rollmean(gradient, 5, fill = NA)) %>% \n  mutate(phase = case_when(\n    smooth_gradient > takeoff_threshold ~ 'Climb',\n    smooth_gradient < landing_threshold ~ 'Descend',\n    TRUE ~ 'Cruise'\n  ))\n```\n:::\n\n\nWhats going on in the code? After cleaning up of the anomalies in the data, I focused on calculating the relative length of the flight since takeoff. To clarify, I'm considering 'takeoff' as the last moment when the altitude is zero and eliminating all prior data points, effectively excluding the taxiing phase (same applies for the landing).\n\nThe next step is to calculate the gradient, which involves correlating the change in altitude with the change in the relative length of the flight. The sign of this gradient indicates whether the plane is ascending or descending between two points. After this, I smooth out the gradient for a clearer analysis. The sign of this gradient indicates whether the flight is ascending or descending.\n\nLet's now revisit the plot, this time analyzing it by the flight phase.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-5_fc987d9f835fba6bbcdc1e37559590b4'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=1260}\n:::\n:::\n\n\nThe results are fascinating! The climb phase (red) requires higher speed to gain altitude, as governed by physical laws, as it sits more towards the right side (higher speed).\n\nWhat's particularly striking is the precision with which the plane maintains altitude at different speeds during the cruise phase (green lines).\n\n## Altitude and Duration\n\nI need to take a closer look at this aspect of maintaining stable altitude.\n\nTherefore, I am plotting the plane's altitude against flight time (measured in minutes).\n\nI will present a summary encompassing all flights, and for enhanced clarity, I will also showcase randomly selected flights throughout this article (you can switch between the different views using the tabs).\n\n::: {.panel-tabset .nav-pills}\n## All Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-6_5bb7c5c864b18ba2c29fcf36d282b616'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=1260}\n:::\n:::\n\n\n## Random Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-7_adeaa6aa740be0f72a53f67acf3c845f'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=1260}\n:::\n:::\n\n:::\n\nIt's amazing to see how the plane maintains a consistent altitude over an extended period of time. Yes, I'm aware there are minor deviations in altitude, or even significant ones during turbulence. The plot here is somewhat smoothed out due to the resolution of the measurement and also the range of the X- and Y-axis, but I'm still impressed.\n\n::: callout-note\nWhat can also be observed is that sometimes the altitude profile has gaps. This is due to the absence of data points in some instances. The reason for this is that Flightradar24 cannot track signals in certain areas of the world (e.g. ocean areas).\n:::\n\nUpon further analysis, I noticed an anomaly on the flight dated November 19th. A quick check on Flightradar24 revealed that on that day, the plane was diverted to Kuala Lumpur after two unsuccessful landing attempts due to bad weather at the airport. I'll exclude this flight from the rest of the analysis.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-8_95b53d8fbc154da2cf2381a987d1a4e9'}\n\n:::\n\n\n## Approaching Singapore\n\nNow, let's address my initial question of the right side of the plane. From the flight path I examined the final descent phase, specifically when the plane was below 1,000 feet in altitude, because at that stage I would expect that the plane is already fully aligned with the runway! Lets first see if this expecation is correct!\n\n::: {.panel-tabset .nav-pills}\n## All Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-9_eca31557378e19052adc2718b7fb43e8'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=1260}\n:::\n:::\n\n\n## Random Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-10_8da58450cef95fae03bb0046f6bbbd34'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=1260}\n:::\n:::\n\n:::\n\nThe green dot represents Singapore Airport's official location. You can see that, at this altitude, the plane is perfectly aligned with the runway. This leads to the next idea that one could analyze which runway is most frequently used by this flight for landing, but that would be going too far.\n\n::: callout-note\nThere is multiple runways at Singapore, thats why the line is shifted from day to day.\n:::\n\nThe data gives a good overview of the approaches! No we need to understand the local circumstances.\n\n## Optimal Seating Side for the Skyline View\n\nHere's an overview of the local situation - regarding the airport's location relative to the city. If the approach is from the southwest (indicated by the purple arrow), then the left side of the plane offers a good view of the skyline. Conversely, during a northeast approach (orange arrow), sitting on the right side is advisable to at least see some part of the city - even if it's not the impressive skyline.\n\n![*Source: Google Maps*](images/Folie1.png){fig-align=\"center\"}\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-11_ab97d088d45ea4a3c10b9d9d701e105e'}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Click here to unhide/hide the code.\"}\nflights_direction <- all_data %>%\n  group_by(label) %>% \n  filter(phase == \"Descend\" & altitude < 1000) %>% \n  group_by(label) %>%\n  summarize(approach_direction = if_else(mean(lat) > 1.359167, \n                                         'north-east', \n                                         'south-west'))\n```\n:::\n\n\nNow, to determine the best side for a view, all I need to do is classify each approach to easily tally them up.\n\nHere's the concept: if the average latitude of the approach is less than the latitude of Singapore airport, then the approach is likely from the northeast. Conversely, if it's higher, the approach is probably from the southeast. Let's calculate and see what the results show.\n\n::: {.panel-tabset .nav-pills}\n## All Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-12_48849197599130fc4bab3de0f060c45e'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){width=1260}\n:::\n:::\n\n\n## Random Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-13_d6fe36e0bb431706bcd48d27fb3fc1fb'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=1260}\n:::\n:::\n\n\n## Result\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-14_58a9672c7ecbb7b59ffa0f29b3bfe1fe'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-14-1.png){width=1260}\n:::\n:::\n\n:::\n\nIt turns out, disappointingly, that only \\~ 25% of the 80 flights approached from the southwest, the direction offering a view of the skyline. However, to maximize my chances, I should choose a seat on the left-hand side of the plane. That's what I'll aim for!\n\n## Flight Duration\n\nTo conclude this blog post as an add-on, I'll examine the duration of the flight. It's scheduled to last 12 hours and 5 minutes, or 720 minutes. Lets see the distribution across all flights in a box plot.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-15_a8db2e43d8029ead3dd5c0dc98c2527c'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.png){width=1260}\n:::\n:::\n\n\nThere's one outlier at 760 minutes, surpassing the scheduled duration. The boxplot shows that 50% of the flights over the past 80 days took less than 700 minutes, while the other half took more. The majority fell between 690 and 717 minutes, which is either below or close to the scheduled time.\n\nBut what accounts for these differences? In analyzing this plot, it's important to consider that while it provides a snapshot of flight durations, further context would be needed to understand the specific causes of a longer or shorter flight duration, such as weather conditions, air flow, air traffic control restrictions, or other operational factors.\n\nLets at least check the aspect of air traffic control restrictions by analyzing holding patterns.\n\n## Holdings\n\nTo analyze holding patterns, I will examine the final 30 minutes of each flight.\\\nLet's plot their routes for further insights.\n\n::: {.panel-tabset .nav-pills}\n## All Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-16_dd0fb5757210987edbe434bcae8f1127'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){width=1260}\n:::\n:::\n\n\n## Random Flights\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-17_a388f1c5864728be10a2a98f5913ae10'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){width=1260}\n:::\n:::\n\n:::\n\nSome flights exhibit distinct holding patterns prior to landing, identifiable by their bow-shaped paths.\n\n## Derivation of Holdings\n\nTo identify holding patterns, the focus is narrowed to the last 30 minutes of each flight, during which significant changes in the bearing could indicate circling or looping maneuvers. The analysis starts by organizing the flight data chronologically for each flight. The bearing, or direction of travel, from one point to the next is calculated for the entire flight path. If there is a high number of consecutive changes in the bearing, this might point to a holding pattern.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-18_76ee64a71dd606aba822d4817fcaf473'}\n\n:::\n\n\n:::{.callout-tip}\nIn order to compute the bearing I used the geosphere library.\n\nHijmans R (2022). _geosphere: Spherical Trigonometry_. \nR package version 1.5-18, <https://CRAN.R-project.org/package=geosphere>.\n\n:::\n\nTo see if the indicator works, lets check with the randomly chosen flights.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-19_88f6fa2f93c405f9e34f137474e502c1'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-19-1.png){width=1260}\n:::\n:::\n\n\nThat looks quite promising. I've experimented a bit and established a rule: if there are more than 30 consecutive points showing a change in direction, I classify the flight as one executing a holding pattern.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-20_7067901161c029a25f8a86622d8ec784'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-20-1.png){width=1260}\n:::\n:::\n\n\nThe approach seems to work reasonably well, though undoubtedly there could be more sophisticated solutions.\n\nLet's proceed with this method and aim to answer the question: Are flights with a holding pattern more susceptible to a longer flight duration? Lets look again into a box-plot for the flight duration across both groups.\n\n\n::: {.cell hash='index_cache/html/unnamed-chunk-21_7c46c5155e094fb8102eab16cd6ce947'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-21-1.png){width=1260}\n:::\n:::\n\n::: {.cell hash='index_cache/html/unnamed-chunk-22_39cbc9fce19d836f87982bfef2695fad'}\n\n:::\n\n\nLooks like that, when flying a holding pattern, the flight takes on average slightly longer (but the majority still below the scheduled duration). On average a flight with a holding pattern takes 706.2 minutes; a flight without a holding pattern only 699.9 minutes. A t-test reveals with a p-value of 0.154 that this difference of ~6 minutes is not significant.\n\n\n## Conclusion\n\nThis was again fun to analyze. Hope you enjoyed it! I will definitely sit on the left side of the plane (thumbs pressed for clear view) and not worry to much about holding patterns since they are pretty usual on this flight.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}